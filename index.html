<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>R√°dio Kombin√°tor - Dynamick√° R√°dia</title>
    <style>
        /* --- CSS: Zachov√°no pro vzhled a p≈ôehlednost --- */
        :root {
            --bg: #f4f7f9;
            --text: #1c1c1c;
            --card-bg: #ffffff;
            --accent: #007bff;
            --shadow: rgba(0, 0, 0, 0.1);
        }

        [data-theme="dark"] {
            --bg: #121212;
            --text: #e0e0e0;
            --card-bg: #1e1e1e;
            --accent: #4da6ff;
        }

        body, html {
            margin: 0; padding: 0;
            font-family: Arial, sans-serif;
            background: var(--bg);
            color: var(--text);
            transition: background 0.3s, color 0.3s;
        }
        a { text-decoration: none; color: var(--accent); }
        a:hover { text-decoration: underline; }

        header {
            background: var(--card-bg);
            padding: 1rem 20px;
            box-shadow: 0 2px 8px var(--shadow);
            position: sticky;
            top: 0;
            z-index: 1000;
        }
        header h1 { margin: 0; font-size: 1.6rem; color: var(--accent); }

        nav {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            padding: 10px 20px;
            background: var(--bg);
            border-bottom: 1px solid #ddd;
        }

        nav button {
            padding: 8px 15px;
            border: 1px solid var(--accent);
            background: var(--card-bg);
            color: var(--text);
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            transition: background 0.2s, color 0.2s;
        }

        nav button:hover {
            background: var(--accent);
            color: white;
        }

        nav button.active {
            background: var(--accent);
            color: white;
        }
        
        .theme-toggle {
            background: var(--card-bg);
            border: 1px solid #ccc;
            font-size: 1.2rem;
            padding: 8px 12px;
            margin-left: auto;
        }
        .theme-toggle:hover {
            background: var(--text);
            color: var(--card-bg);
        }

        .main-content {
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }

        #searchInput {
            width: 100%;
            padding: 12px;
            font-size: 1rem;
            margin: 10px 0 15px 0;
            border-radius: 8px;
            border: 1px solid #ccc;
            box-sizing: border-box;
            background: var(--card-bg);
            color: var(--text);
        }
        [data-theme="dark"] #searchInput { border-color: #555; }

        #radioList {
            list-style: none;
            padding: 0;
            margin: 0;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 10px;
        }

        .station-item {
            background: var(--card-bg);
            padding: 12px 15px;
            border-radius: 8px;
            box-shadow: 0 1px 3px var(--shadow);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
        }
        .station-info { flex-grow: 1; min-width: 0; }
        .station-info h3 { margin: 0 0 4px 0; font-size: 1.1rem; }
        .station-info small { display: block; color: #666; }
        [data-theme="dark"] .station-info small { color: #aaa; }
        
        /* Styl pro pevnƒõ definovan√© stanice */
        .fixed-station { border-left: 5px solid var(--accent); }

        .station-actions button {
            padding: 8px 12px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: background 0.2s;
        }
        .play-btn { background: var(--accent); color: white; }
        .play-btn:hover { background: #0056b3; }
        .link-btn { background: #f0f0f0; color: var(--accent); border: 1px solid #ccc; }
        [data-theme="dark"] .link-btn { background: #333; color: var(--accent); border: 1px solid #555; }

        .player-area {
            background: var(--card-bg);
            padding: 15px 20px;
            border-radius: 10px;
            box-shadow: 0 4px 10px var(--shadow);
            margin-top: 20px;
            text-align: center;
            display: none;
            border: 1px solid var(--accent);
        }
        .player-area audio {
            width: 100%;
            max-width: 600px;
            filter: invert(var(--theme-invert, 0%)); /* Inverze pro tmav√Ω motiv */
        }
        [data-theme="dark"] .player-area audio { --theme-invert: 100%; }

        #genresContainer {
            margin-top: 10px;
            margin-bottom: 15px;
            display: none;
        }

        #genresList {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }
        #genresList button {
            padding: 8px 14px;
            border-radius: 20px;
            background: #e0e0e0;
            border: 1px solid #ccc;
            cursor: pointer;
            transition: 0.2s;
            white-space: nowrap;
            color: var(--text);
        }
        [data-theme="dark"] #genresList button { background: #333; border-color: #555; color: #e0e0e0; }
        #genresList button:hover, #genresList button.active {
            background: var(--accent);
            color: white;
            border-color: var(--accent);
        }
        .genre-title {
            font-size: 1.2rem;
            margin-bottom: 10px;
            color: var(--accent);
            font-weight: bold;
        }

        #searchEnginesContent {
            display: none;
            margin-top: 20px;
        }
        #searchEnginesList {
            list-style: none;
            padding-left: 0;
        }
        #searchEnginesList li {
            background: var(--card-bg);
            margin-bottom: 10px;
            padding: 12px 15px;
            border-radius: 6px;
            border: 1px solid #ddd;
            font-size: 1.1rem;
            font-weight: 600;
        }
        [data-theme="dark"] #searchEnginesList li { border-color: #333; }

        @media (max-width: 600px) {
            nav { flex-direction: column; }
            nav button { width: 100%; margin-bottom: 5px; }
            .theme-toggle { margin-left: 0; }
            .station-item { flex-direction: column; align-items: flex-start; }
            .station-actions { width: 100%; display: flex; gap: 5px; }
            .station-actions button { flex-grow: 1; }
        }
    </style>
</head>
<body>

<header>
    <h1>üåê R√°dio Kombin√°tor</h1>
</header>

<nav>
    <button id="nav-cz" class="active" onclick="selectView('cz')">üá®üáø ƒåesk√° R√°dia</button>
    <button id="nav-world" onclick="selectView('world')">üåç Svƒõtov√° R√°dia</button>
    <button id="nav-genres" onclick="selectView('genres')">üéß CZ podle ≈Ω√°nru</button>
    <button id="nav-world-genres" onclick="selectView('world-genres')">üåç World podle ≈Ω√°nru</button>
    <button id="nav-searchEngines" onclick="selectView('searchEngines')">üîó Vyhled√°vaƒçe R√°di√≠</button>
    <input type="text" id="searchInput" placeholder="Hledat: N√°zev, Zemƒõ, ≈Ω√°nr..." oninput="filterStations()">
    <button class="theme-toggle" onclick="toggleTheme()">üåô</button>
</nav>

<div class="main-content">

    <div class="player-area" id="playerArea">
        <div class="player-label" id="playerLabel">P≈ôehr√°vaƒç</div>
        <audio id="audioPlayer" controls autoplay></audio>
    </div>
    
    <div id="genresContainer">
        <div class="genre-title" id="genresTitle">Vyberte ≈æ√°nr pro filtrov√°n√≠ stanic:</div>
        <div id="genresList"></div>
    </div>
    
    <div id="searchEnginesContent">
        <p style="color: #777; margin-top: 5px;">Extern√≠ katalogy r√°di√≠. Pro nalezen√≠ dal≈°√≠ch stream≈Ø pou≈æijte tyto zdroje:</p>
        <ul id="searchEnginesList">
            <li><a href="https://www.radio-browser.info" target="_blank" rel="noopener noreferrer">Radio-browser.info</a> ‚Äì **Open source datab√°ze r√°di√≠ (zdroj dat pro tuto str√°nku)**</li>
            <li><a href="https://radios.cz" target="_blank" rel="noopener noreferrer">Radios.cz</a> ‚Äì ƒåesk√Ω katalog internetov√Ωch r√°di√≠ a stream≈Ø</li>
            <li><a href="https://radioplayer.cz" target="_blank" rel="noopener noreferrer">Radioplayer.cz</a> ‚Äì Ofici√°ln√≠ ƒçesk√Ω p≈ôehr√°vaƒç r√°di√≠</li>
            <li><a href="https://tunein.com" target="_blank" rel="noopener noreferrer">TuneIn.com</a> ‚Äì Glob√°ln√≠ a obl√≠ben√° platforma pro streamov√°n√≠ r√°di√≠</li>
            <li><a href="https://www.radio.net" target="_blank" rel="noopener noreferrer">Radio.net</a> ‚Äì Dal≈°√≠ velk√Ω mezin√°rodn√≠ r√°dio katalog</li>
        </ul>
    </div>

    <ul id="radioList">
        <li>Naƒç√≠t√°m poƒç√°teƒçn√≠ stanice...</li>
    </ul>

</div>

<script>
    const API_URL = "https://de1.api.radio-browser.info/json/stations";

    // --- DOM Elementy ---
    const radioListEl = document.getElementById('radioList');
    const searchInput = document.getElementById('searchInput');
    const playerArea = document.getElementById('playerArea');
    const playerLabel = document.getElementById('playerLabel');
    const audioPlayer = document.getElementById('audioPlayer');
    const genresContainer = document.getElementById('genresContainer');
    const genresList = document.getElementById('genresList');
    const genresTitle = document.getElementById('genresTitle');
    const searchEnginesContent = document.getElementById('searchEnginesContent');

    // --- CENTRALIZOVAN√ù STAV A DATA ---
    const AppState = {
        czStations: [],
        worldStations: [],
        currentView: 'cz',
        activeGenre: null, // Uchov√°v√° aktu√°lnƒõ aktivn√≠ ≈æ√°nr
        // Pevnƒõ definovan√© ƒçesk√© stanice s funkƒçn√≠mi streamy (ROZ≈†√ç≈òEN√Å VERZE)
        fixedCZStations: [
            // --- Hlavn√≠ celoplo≈°n√© stanice ---
            { name: "ƒåRo Radio≈æurn√°l", url_resolved: "https://d15.radiozurnal.cz/radiozurnal_online_48.mp3", homepage: "https://radiozurnal.cz/", country: "Czechia", countrycode: "CZ", tags: "zpravy,publicistika,hudba,pop" },
            { name: "ƒåRo Dvojka", url_resolved: "https://d12.dvojka.cz/dvojka_online_48.mp3", homepage: "https://dvojka.cz/", country: "Czechia", countrycode: "CZ", tags: "rodina,zivotni styl,cestovani,hudba" },
            { name: "ƒåRo Vltava", url_resolved: "https://d10.vltava.cz/vltava_online_48.mp3", homepage: "https://vltava.cz/", country: "Czechia", countrycode: "CZ", tags: "klasika,kultura,literatura,jazz" },
            { name: "ƒåRo Plus", url_resolved: "https://d16.plus.cz/plus_online_48.mp3", homepage: "https://radiozurnal.cz/plus", country: "Czechia", countrycode: "CZ", tags: "zpravy,analyzy,politika,ekonomika" },
            { name: "R√°dio Impuls", url_resolved: "https://ice.abradio.cz/impuls128.mp3", homepage: "https://impuls.cz/", country: "Czechia", countrycode: "CZ", tags: "pop,zpravy,doprava,oldies" },
            { name: "Evropa 2", url_resolved: "https://ice.abradio.cz/evropa2128.mp3", homepage: "https://e2.cz/", country: "Czechia", countrycode: "CZ", tags: "hudba,top 40,pop,souteze" },
            { name: "Frekvence 1", url_resolved: "https://ice.abradio.cz/f1128.mp3", homepage: "https://frekvence1.cz/", country: "Czechia", countrycode: "CZ", tags: "hudba,zpravy,pop" },
            
            // --- Popul√°rn√≠ komerƒçn√≠ stanice a ƒåRo dopl≈àky ---
            { name: "R√°dio Blan√≠k", url_resolved: "https://ice2.radia.cz/blanikcz64.aac", homepage: "https://radioblanik.cz/", country: "Czechia", countrycode: "CZ", tags: "ceske hity,pop,oldies" },
            { name: "Kiss", url_resolved: "https://icecast6.play.cz/kiss128.mp3", homepage: "https://www.kiss.cz/", country: "Czechia", countrycode: "CZ", tags: "dance,pop,hits" },
            { name: "Radio Beat", url_resolved: "https://ice.abradio.cz/beat128.mp3", homepage: "https://radiobeat.cz/", country: "Czechia", countrycode: "CZ", tags: "classic rock,bigbit,rock" },
            { name: "Country Radio", url_resolved: "https://ice.abradio.cz/country128.mp3", homepage: "https://countryradio.cz/", country: "Czechia", countrycode: "CZ", tags: "country,folk,bluegrass" },
            { name: "Expres FM", url_resolved: "https://icecast6.play.cz/expres128.mp3", homepage: "https://expresfm.cz/", country: "Czechia", countrycode: "CZ", tags: "alternativa,talk,modern" },
            { name: "Classic Praha", url_resolved: "https://icecast6.play.cz/classic128.mp3", homepage: "https://classicpraha.cz/", country: "Czechia", countrycode: "CZ", tags: "klasika,filmova hudba" },
            { name: "Dance Radio", url_resolved: "https://icecast6.play.cz/dance128.mp3", homepage: "https://danceradio.cz/", country: "Czechia", countrycode: "CZ", tags: "dance,elektronicka,house" },
            { name: "Radio Han√°", url_resolved: "https://icecast5.play.cz/hanacz128.mp3", homepage: "https://radiohana.cz/", country: "Czechia", countrycode: "CZ", tags: "pop,oldies,regionalni" },
            { name: "RockZone", url_resolved: "https://icecast6.play.cz/rockzone128.mp3", homepage: "https://rockzone.cz/", country: "Czechia", countrycode: "CZ", tags: "rock,metal,alternative" },
            { name: "R√°dio ƒåas", url_resolved: "https://icecast6.play.cz/cas128.mp3", homepage: "https://casradio.cz/", country: "Czechia", countrycode: "CZ", tags: "pop,regionalni,morava" },
            { name: "Fajn R√°dio", url_resolved: "https://ice.abradio.cz/fajn128.mp3", homepage: "https://fajnradio.cz/", country: "Czechia", countrycode: "CZ", tags: "pop,hip hop,hits" },
            { name: "ƒåRo Radio Wave", url_resolved: "https://d15.radiowave.cz/radiowave_online_128.mp3", homepage: "https://wave.rozhlas.cz/", country: "Czechia", countrycode: "CZ", tags: "alternativa,indie,elektronika" },
            { name: "ƒåRo Jazz", url_resolved: "https://d13.jazz.cz/jazz_online_48.mp3", homepage: "https://jazz.rozhlas.cz/", country: "Czechia", countrycode: "CZ", tags: "jazz,hudba,blues" },
            { name: "ƒåRo D-dur", url_resolved: "https://d16.d-dur.cz/d-dur_online_48.mp3", homepage: "https://d-dur.rozhlas.cz/", country: "Czechia", countrycode: "CZ", tags: "klasika,opera,vazna hudba" },
            { name: "ƒåRo Pohoda", url_resolved: "https://d16.pohoda.cz/pohoda_online_48.mp3", homepage: "https://pohoda.rozhlas.cz/", country: "Czechia", countrycode: "CZ", tags: "oldies,retro,pop" }
        ]
    };

    // --- POMOCN√â FUNKCE ---

    function getFlagEmoji(countryCode) {
        if (!countryCode || countryCode.length !== 2) return '';
        const codePoints = countryCode.toUpperCase().split('').map(c => 127397 + c.charCodeAt());
        return String.fromCodePoint(...codePoints);
    }

    function capitalize(str) {
        if (!str || str.trim() === '') return '';
        return str.charAt(0).toUpperCase() + str.slice(1);
    }

    // Generov√°n√≠ polo≈æky r√°dia
    function generateStationItemHTML(st, isCzech = false) {
        // Kontrola, zda je stanice z pevn√©ho seznamu
        const isFixed = AppState.fixedCZStations.some(f => f.name === st.name);
        
        const countryInfo = isCzech ? `ƒåesko ${getFlagEmoji('CZ')}` : `${st.country} ${getFlagEmoji(st.countrycode)}`;
        // Zpracov√°n√≠ tag≈Ø: limit na 3, trimov√°n√≠, capitalizace
        const tags = st.tags ? st.tags.split(',').map(t => capitalize(t.trim())).filter(t => t.length > 0).slice(0, 3).join(', ') : 'Nezn√°m√©';
        const nameDisplay = st.name.length > 50 ? st.name.substring(0, 47) + '...' : st.name;
        // Pou≈æijeme url_resolved nebo url z pevn√©ho seznamu
        const streamUrl = st.url_resolved || st.url;

        return `
            <li class="station-item ${isFixed ? 'fixed-station' : ''}" data-name="${st.name}" data-country="${st.country}" data-tags="${st.tags}">
                <div class="station-info">
                    <h3>${nameDisplay} ${isFixed ? ' ‚≠ê' : ''}</h3>
                    <small>
                        ${countryInfo} 
                        ${st.city ? `| Mƒõsto: ${st.city}` : ''}
                        | ≈Ω√°nry: ${tags}
                    </small>
                </div>
                <div class="station-actions">
                    <button 
                        class="play-btn" 
                        data-url="${streamUrl}" 
                        data-name="${st.name}"
                        onclick="playStation(this)">
                        ‚ñ∂ P≈ôehr√°t
                    </button>
                    <a href="${st.homepage}" target="_blank" rel="noopener noreferrer" class="link-btn" style="${st.homepage ? '' : 'display:none;'}">üåê Web</a>
                </div>
            </li>
        `;
    }

    // Render seznamu stanic do DOM
    function renderStationList(stations, isCzech = false) {
        let finalStations = stations;
        
        if(!finalStations || finalStations.length === 0) {
            radioListEl.innerHTML = '<li>Nebyly nalezeny ≈æ√°dn√© stanice odpov√≠daj√≠c√≠ filtru/v√Ωbƒõru.</li>';
            return;
        }
        radioListEl.innerHTML = finalStations.map(s => generateStationItemHTML(s, isCzech)).join('');
    }

    // --- FUNKCE PRO NAƒå√çT√ÅN√ç DAT Z API ---

    async function fetchData(endpoint, count, filterCZ = false) {
        try {
            // M√≠sto 'bycountrycodeexact/CZ/limit/1000' pou≈æijeme obecn√Ω endpoint pro v≈°echny CZ, 
            // nebo pro TopClick a limit.
            const url = count ? `${API_URL}/${endpoint}/${count}` : `${API_URL}/${endpoint}`;

            const res = await fetch(url);
            if (!res.ok) throw new Error(`Selhalo z√≠sk√°n√≠ dat z API. Status: ${res.status}`);
            let data = await res.json();
            
            // Filtrov√°n√≠ pro svƒõtov√© stanice
            if(filterCZ) {
                data = data.filter(s => s.countrycode !== 'CZ');
            }
            
            return data;
        } catch(e) {
            console.error(e);
            return [];
        }
    }

    // NAƒå√çT√ÅN√ç V≈†ECH CZ R√ÅDI√ç (Pevn√© + API)
    async function fetchCZStations() {
        radioListEl.innerHTML = '<li>‚è≥ Naƒç√≠t√°m **v≈°echna** ƒçesk√° r√°dia z API Radio-Browser a ovƒõ≈ôen√© streamy...</li>'; 
        
        // Z√≠sk√°me v≈°echny stanice podle countrycode (CZ) - vol√°me endpoint bez umƒõl√©ho limitu klik≈Ø
        const apiData = await fetchData('bycountrycodeexact/CZ', null);

        // Slouƒçen√≠ dat:
        // 1. Odebr√°n√≠ duplicit z API (pokud maj√≠ stejn√Ω n√°zev jako pevn√©), a vynech√°n√≠ nefunkƒçn√≠ch stream≈Ø
        const fixedNames = AppState.fixedCZStations.map(s => s.name);
        const uniqueApiStations = apiData.filter(s => 
            !fixedNames.includes(s.name) && s.url_resolved && s.url_resolved.length > 5 // Kontrola URL
        );
        
        // 2. Nejprve pevn√© stanice, pot√© unik√°tn√≠ stanice z API.
        AppState.czStations = [...AppState.fixedCZStations, ...uniqueApiStations];

        if(AppState.currentView === 'cz' || AppState.currentView === 'genres') {
            if(AppState.currentView === 'cz') renderStationList(AppState.czStations, true);
            generateGenresButtons(AppState.czStations);
        } else {
             // Pokud se mezit√≠m zmƒõnila z√°lo≈æka, nic se neprov√°d√≠
             radioListEl.innerHTML = '<li>Data pro jinou sekci jsou naƒçtena.</li>';
        }
    }

    async function fetchWorldStations() {
        radioListEl.innerHTML = '<li>‚è≥ Naƒç√≠t√°m svƒõtov√° r√°dia (Max 8000 nejklik√°nƒõj≈°√≠ch)...</li>';
        // Z√≠sk√°me nejklik√°nƒõj≈°√≠ stanice a odfiltrujeme CZ
        const data = await fetchData('topclick', 8000, true); 
        AppState.worldStations = data;
        if(AppState.currentView === 'world' || AppState.currentView === 'world-genres') {
            if(AppState.currentView === 'world') renderStationList(data, false);
            generateGenresButtons(AppState.worldStations);
        } else {
            radioListEl.innerHTML = '<li>Data pro jinou sekci jsou naƒçtena.</li>';
        }
    }

    // --- FUNKCE PRO ≈Ω√ÅNRY A FILTROV√ÅN√ç ---

    function generateGenresButtons(stations) {
        // Pouze tagy s v√≠ce ne≈æ 3 stanicemi, bez ƒç√≠slic a speci√°ln√≠ch znak≈Ø
        let genreMap = new Map();
        stations.forEach(s => {
            if(s.tags) {
                s.tags.split(',').forEach(t => {
                    const trimmed = t.trim().toLowerCase();
                    // Z√°kladn√≠ filtrace tag≈Ø
                    if(trimmed.length > 2 && trimmed.length < 20 && !/\d/.test(trimmed)) {
                        genreMap.set(trimmed, (genreMap.get(trimmed) || 0) + 1);
                    }
                });
            }
        });
        
        // Se≈ôadit a filtrovat tagy s minim√°ln√≠m poƒçtem stanic (nap≈ô. 5)
        const genres = Array.from(genreMap.keys())
            .filter(g => genreMap.get(g) >= 5)
            .sort();

        genresList.innerHTML = genres.map(g => 
            `<button onclick="loadGenre('${g}', this)" class="${AppState.activeGenre === g ? 'active' : ''}">${capitalize(g)}</button>`
        ).join('');
    }
    
    // Naƒçten√≠ stanic podle ≈æ√°nru
    function loadGenre(genre, button) {
        const isCZ = AppState.currentView === 'genres';
        const stationsToFilter = isCZ ? AppState.czStations : AppState.worldStations;
        
        // Toggle aktivn√≠ho ≈æ√°nru
        if (AppState.activeGenre === genre) {
            AppState.activeGenre = null;
            document.querySelectorAll('#genresList button').forEach(btn => btn.classList.remove('active'));
        } else {
            AppState.activeGenre = genre;
            document.querySelectorAll('#genresList button').forEach(btn => btn.classList.remove('active'));
            if (button) button.classList.add('active');
        }

        genresTitle.textContent = (isCZ ? `ƒåesk√© r√°dia: ` : `Svƒõtov√° r√°dia: `) + (AppState.activeGenre ? `≈Ω√°nr: ${capitalize(AppState.activeGenre)}` : `V≈°echny ≈æ√°nry`);
        
        // Zobrazit v≈°echny stanice (po odkliknut√≠ filtru)
        if (!AppState.activeGenre) {
             renderStationList(stationsToFilter, isCZ);
             return;
        }

        const filtered = stationsToFilter.filter(s => 
            s.tags && s.tags.toLowerCase().split(',').map(t => t.trim()).includes(AppState.activeGenre)
        );

        if(filtered.length === 0) {
            radioListEl.innerHTML = `<li>Pro ≈æ√°nr <strong>${capitalize(AppState.activeGenre)}</strong> nebyly nalezeny ≈æ√°dn√© stanice.</li>`;
        } else {
            renderStationList(filtered, isCZ);
        }
    }

    // Filtrace podle hledan√©ho v√Ωrazu (pouze v CZ a World z√°lo≈æk√°ch)
    function filterStations() {
        const searchTerm = searchInput.value.toLowerCase().trim();
        const isCZ = AppState.currentView === 'cz';

        if(AppState.currentView === 'genres' || AppState.currentView === 'world-genres' || AppState.currentView === 'searchEngines') return;
        
        AppState.activeGenre = null; // Zru≈°it filtr ≈æ√°nru p≈ôi ruƒçn√≠m vyhled√°v√°n√≠
        document.querySelectorAll('#genresList button').forEach(btn => btn.classList.remove('active'));

        const stationsToFilter = isCZ ? AppState.czStations : AppState.worldStations;

        if(searchTerm === '') {
            renderStationList(stationsToFilter, isCZ);
            return;
        }

        const filtered = stationsToFilter.filter(s =>
            s.name.toLowerCase().includes(searchTerm) ||
            (s.country && s.country.toLowerCase().includes(searchTerm)) ||
            (s.tags && s.tags.toLowerCase().includes(searchTerm)) ||
            (s.city && s.city.toLowerCase().includes(searchTerm))
        );

        renderStationList(filtered, isCZ);
    }

    // --- FUNKCE PRO P≈òEHR√ÅV√ÅN√ç ---

    // Funkce p≈ôehr√°v√°n√≠ volan√° z HTML tlaƒç√≠tka
    function playStation(buttonElement) {
        const url = buttonElement.getAttribute('data-url');
        const name = buttonElement.getAttribute('data-name');
        
        playerArea.style.display = 'block';
        playerLabel.textContent = `P≈ô√≠prava: ${name}`;

        // Kontrola, zda je pot≈ôeba stream zastavit a znovu naƒç√≠st
        if (audioPlayer.src !== url) {
            audioPlayer.pause();
            audioPlayer.src = url;
            audioPlayer.load();
        }

        audioPlayer.play().then(() => {
            // √öspƒõ≈°n√© spu≈°tƒõn√≠
            playerLabel.textContent = `‚ñ∂ Hraje: ${name}`;
        }).catch(e => {
            // Chyba p≈ôehr√°v√°n√≠
            console.error("Chyba p≈ôehr√°v√°n√≠:", e);
            playerLabel.textContent = `‚ùå Chyba p≈ôi spu≈°tƒõn√≠ ${name}. Stream nen√≠ dostupn√Ω, nebo form√°t nen√≠ podporov√°n. Zkuste Web.`;
            audioPlayer.src = ""; // Vyƒçistit zdroj
        });
    }


    // --- FUNKCE PRO P≈òEP√çN√ÅN√ç POHLED≈Æ ---

    async function selectView(viewName) {
        AppState.currentView = viewName;
        AppState.activeGenre = null;
        
        // Reset vizu√°ln√≠ho stavu
        document.querySelectorAll('nav button').forEach(btn => btn.classList.remove('active'));
        document.getElementById(`nav-${viewName}`).classList.add('active');
        genresContainer.style.display = 'none';
        searchEnginesContent.style.display = 'none';
        radioListEl.style.display = 'grid';
        searchInput.value = '';
        searchInput.disabled = false;
        genresTitle.textContent = 'Vyberte ≈æ√°nr pro filtrov√°n√≠ stanic:';
        genresList.innerHTML = '';


        switch(viewName) {
            case 'cz':
                if(AppState.czStations.length === 0) await fetchCZStations();
                else renderStationList(AppState.czStations, true);
                searchInput.placeholder = "Hledat: N√°zev, ≈Ω√°nr (v CZ stanic√≠ch)...";
                break;

            case 'world':
                if(AppState.worldStations.length === 0) await fetchWorldStations();
                else renderStationList(AppState.worldStations, false);
                searchInput.placeholder = "Hledat: N√°zev, Zemƒõ, ≈Ω√°nr (ve svƒõtov√Ωch stanic√≠ch)...";
                break;

            case 'genres':
                genresContainer.style.display = 'block';
                searchInput.placeholder = "Vyhled√°v√°n√≠ je v re≈æimu ≈Ω√°nry neaktivn√≠.";
                searchInput.disabled = true;
                if(AppState.czStations.length === 0) await fetchCZStations();
                else {
                    generateGenresButtons(AppState.czStations);
                    radioListEl.innerHTML = '<li>Vyberte ≈æ√°nr z tlaƒç√≠tek v√Ω≈°e pro filtrov√°n√≠ ƒçesk√Ωch stanic.</li>';
                }
                break;

            case 'world-genres':
                genresContainer.style.display = 'block';
                searchInput.placeholder = "Vyhled√°v√°n√≠ je v re≈æimu ≈Ω√°nry neaktivn√≠.";
                searchInput.disabled = true;
                if(AppState.worldStations.length === 0) await fetchWorldStations();
                else {
                    generateGenresButtons(AppState.worldStations);
                    radioListEl.innerHTML = '<li>Vyberte ≈æ√°nr z tlaƒç√≠tek v√Ω≈°e pro filtrov√°n√≠ svƒõtov√Ωch stanic.</li>';
                }
                break;

            case 'searchEngines':
                searchEnginesContent.style.display = 'block';
                radioListEl.style.display = 'none';
                searchInput.placeholder = "Vyhled√°v√°n√≠ je v re≈æimu Vyhled√°vaƒçe neaktivn√≠.";
                searchInput.disabled = true;
                break;

            default:
                radioListEl.innerHTML = '<li>Nezn√°m√Ω re≈æim.</li>';
                break;
        }
    }
    
    // --- FUNKCE PRO T√âMA ---

    function initializeTheme() {
        if(localStorage.getItem("theme") === "dark") {
            document.documentElement.setAttribute("data-theme", "dark");
            document.querySelector(".theme-toggle").textContent = "‚òÄÔ∏è";
        }
    }

    function toggleTheme() {
        const isDark = document.documentElement.getAttribute("data-theme") === "dark";
        if(isDark) {
            document.documentElement.removeAttribute("data-theme");
            localStorage.setItem("theme", "light");
            document.querySelector(".theme-toggle").textContent = "üåô";
        } else {
            document.documentElement.setAttribute("data-theme", "dark");
            localStorage.setItem("theme", "dark");
            document.querySelector(".theme-toggle").textContent = "‚òÄÔ∏è";
        }
    }

    // --- INICIALIZACE ---

    initializeTheme();
    selectView('cz'); // Spu≈°tƒõn√≠ s CZ r√°diem
</script>

</body>
</html>
